!function(e,t){"use strict";var s=e.document;jQuery(s).ready(function(s){function o(e,t){"all"!==t&&"undefined"!=typeof t&&""!==t||(t="all");var s={"post-suggest":{text:e,completion:{field:"term_suggest_"+t}}};return s}function a(t){var o=e.ElasticPressAutoSuggest.index+"/",a=p+o+"_suggest";jQuery.support.cors=!0;var n;return n=s.ajax({url:a,type:"POST",dataType:"json",crossDomain:!0,data:e.JSON.stringify(t)})}function n(t,s){var o=null;return function(){var a=this,n=arguments;e.clearTimeout(o),o=e.setTimeout(function(){t.apply(a,n)},s)}}function u(e,t){var o,a=t.closest(".ep-autosuggest-container").find(".ep-autosuggest"),n=a.find(".autosuggest-list");n.empty();var u;for(s(".autosuggest-item").unbind(),e.length>0?a.show():a.hide(),o=0;o<e.length;++o){var c=e[o].text.toLowerCase();u='<li><span class="autosuggest-item" data-search="'+c+'">'+c+"</span></li>",s(u).appendTo(n)}s(".autosuggest-item").on("click",function(e){var o=s(this).data("search");i(t,o),r(t)}),t.unbind("keydown"),t.on("keydown",function(e){if(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode);else{var s,o=t.closest(".ep-autosuggest-container").find(".autosuggest-list li"),a=o.filter(".selected");switch(e.keyCode){case 38:s=a.prev();break;case 40:o.hasClass("selected")||o.first().addClass("selected"),s=a.next();break;case 13:if(o.hasClass("selected"))return i(t,a.find("span").text()),r(t),!1}if(s.is("li")&&(a.removeClass("selected"),s.addClass("selected")),38===e.keyCode)return!1}})}function i(e,t){e.val(t)}function r(e){e.closest("form").submit()}function c(){s(".autosuggest-list").empty(),s(".ep-autosuggest").hide()}var l=s("input.elasticpress-autosuggest"),d=s('<div class="ep-autosuggest"><ul class="autosuggest-list"></ul></div>');l.each(function(e,t){var o=s('<div class="ep-autosuggest-container"></div>'),a=s(t);a.attr("autocomplete","off"),o.insertAfter(a);var n=a.siblings("label");a.closest("form").find(".ep-autosuggest-container").append(n).append(a),d.clone().insertAfter(a),a.trigger("elasticpress.input.moved")});var g=e.location.host,f=l.data("es-host");f!==t&&null!==f&&f.length>0&&(g=l.data("es-host"));var p=e.location.protocol+"//"+g+"/es-search/";d.css({top:l.outerHeight()-1,"background-color":l.css("background-color")}),s(l).each(function(e,t){s(t).bind("keyup keydown keypress",function(e){38!==e.keyCode&&40!==e.keyCode||e.preventDefault(),27===e.keyCode&&c()})}),l.each(function(t,i){var r=s(i);r.on("keyup",n(function(t){if(38!==t.keyCode&&40!==t.keyCode&&13!==t.keyCode&&27!==t.keyCode){var s,n,i=r.val(),l=e.ElasticPressAutoSuggest.postType;i.length>=2?(s=o(i,l),n=a(s),n.done(function(e){if(e._shards.successful>0){var t=e["post-suggest"][0].options;0===t.length?c():u(t,r)}else c()})):0===i.length&&c()}},100))})})}(this);