/*! ElasticPress Autosuggest - v0.1.0
 * 
 * Copyright (c) 2017; * Licensed GPLv2+ */
!function(a){"use strict";function b(a){a.closest("form").submit()}function c(a,b){a.val(b)}function d(a,b){var c=null;return function(){var d=this,e=arguments;window.clearTimeout(c),c=window.setTimeout(function(){a.apply(d,e)},b)}}function e(a,b){"all"!==b&&"undefined"!=typeof b&&""!==b||(b="all");var c={"post-suggest":{text:a,completion:{field:"term_suggest_"+b}}};return c}function f(b){var c=epas.host+epas.index+"/_suggest";jQuery.support.cors=!0;var d;return d=a.ajax({url:c,type:"POST",dataType:"json",crossDomain:!0,data:JSON.stringify(b)})}function g(d,e){var f,g=e.closest(".ep-autosuggest-container").find(".ep-autosuggest"),h=g.find(".autosuggest-list");h.empty();var i;for(a(".autosuggest-item").off(),d.length>0?g.show():g.hide(),f=0;f<d.length;++f){var j=d[f].text.toLowerCase();i='<li><span class="autosuggest-item" data-search="'+j+'">'+j+"</span></li>",a(i).appendTo(h)}a(".autosuggest-item").on("click",function(a){c(e,a.srcElement.innerText),b(e)}),e.unbind("keydown"),e.on("keydown",function(a){if(38!==a.keyCode&&40!==a.keyCode&&13!==a.keyCode);else{var d,f=e.closest(".ep-autosuggest-container").find(".autosuggest-list li"),g=f.filter(".selected");switch(a.keyCode){case 38:d=g.prev();break;case 40:f.hasClass("selected")||f.first().addClass("selected"),d=g.next();break;case 13:if(f.hasClass("selected"))return c(e,g.find("span").text()),b(e),!1}if(d.is("li")&&(g.removeClass("selected"),d.addClass("selected")),38===a.keyCode)return!1}})}function h(){a(".autosuggest-list").empty(),a(".ep-autosuggest").hide()}if(epas.host&&""!==epas.host&&epas.index&&""!==epas.index){var i=a('input.elasticpress-autosuggest, input[type="search"]'),j=a('<div class="ep-autosuggest"><ul class="autosuggest-list"></ul></div>');i.each(function(b,c){var d=a('<div class="ep-autosuggest-container"></div>'),e=a(c);e.attr("autocomplete","off"),d.insertAfter(e);var f=e.siblings("label");e.closest("form").find(".ep-autosuggest-container").append(f).append(e),j.clone().insertAfter(e),e.trigger("elasticpress.input.moved")}),j.css({top:i.outerHeight()-1,"background-color":i.css("background-color")}),a(i).each(function(b,c){a(c).on("keyup keydown keypress",function(a){38!==a.keyCode&&40!==a.keyCode||a.preventDefault(),27===a.keyCode&&h()})}),i.each(function(b,c){var i=a(c);i.on("keyup",d(function(a){if(38!==a.keyCode&&40!==a.keyCode&&13!==a.keyCode&&27!==a.keyCode){var b,c,d=i.val(),j=epas.postType;d.length>=2?(b=e(d,j),c=f(b),c.done(function(a){if(a._shards.successful>0){var b=a["post-suggest"][0].options;0===b.length?h():g(b,i)}else h()})):0===d.length&&h()}},100))})}}(jQuery);