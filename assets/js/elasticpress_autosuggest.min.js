/*! ElasticPress Autosuggest - v0.1.0
 * http://github.com/10up/ElasticPress-Autosuggest
 * Copyright (c) 2015; * Licensed GPLv2+ */
(function(e,t){"use strict";var s=e.document;jQuery(s).ready(function(s){function o(e,s){("all"===s||s===t||""===s)&&(s="all");var o={"post-suggest":{text:e,completion:{field:"term_suggest_"+s}}};return o}function n(t){var o=e.ElasticPressAutoSuggest.index+"/",n=p+o+"_suggest";jQuery.support.cors=!0;var a;return a=s.ajax({url:n,type:"POST",dataType:"json",crossDomain:!0,data:e.JSON.stringify(t)})}function a(t,s){var o=null;return function(){var n=this,a=arguments;e.clearTimeout(o),o=e.setTimeout(function(){t.apply(n,a)},s)}}function u(e,t){var o,n=t.closest(".ep-autosuggest-container").find(".ep-autosuggest"),a=n.find(".autosuggest-list");a.empty();var u;for(s(".autosuggest-item").unbind(),e.length>0?n.show():n.hide(),o=0;e.length>o;++o){var c=e[o].text.toLowerCase();u='<li><span class="autosuggest-item" data-search="'+c+'">'+c+"</span></li>",s(u).appendTo(a)}s(".autosuggest-item").on("click",function(e){i(t,e.srcElement.innerText),r(t)}),t.unbind("keydown"),t.on("keydown",function(e){if(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode);else{var s,o=t.closest(".ep-autosuggest-container").find(".autosuggest-list li"),n=o.filter(".selected");switch(e.keyCode){case 38:s=n.prev();break;case 40:o.hasClass("selected")||o.first().addClass("selected"),s=n.next();break;case 13:if(o.hasClass("selected"))return i(t,n.find("span").text()),r(t),!1}if(s.is("li")&&(n.removeClass("selected"),s.addClass("selected")),38===e.keyCode)return!1}})}function i(e,t){e.val(t)}function r(e){e.closest("form").submit()}function c(){s(".autosuggest-list").empty(),s(".ep-autosuggest").hide()}var l=s("input.elasticpress-autosuggest"),d=s('<div class="ep-autosuggest"><ul class="autosuggest-list"></ul></div>');l.each(function(e,t){var o=s('<div class="ep-autosuggest-container"></div>'),n=s(t);n.attr("autocomplete","off"),o.insertAfter(n);var a=n.siblings("label");n.closest("form").find(".ep-autosuggest-container").append(a).append(n),d.clone().insertAfter(n),n.trigger("elasticpress.input.moved")});var g=e.location.host,f=l.data("es-host");f!==t&&null!==f&&f.length>0&&(g=l.data("es-host"));var p=e.location.protocol+"//"+g+"/es-search/";d.css({top:l.outerHeight()-1,"background-color":l.css("background-color")}),s(l).each(function(e,t){s(t).bind("keyup keydown keypress",function(e){(38===e.keyCode||40===e.keyCode)&&e.preventDefault(),27===e.keyCode&&c()})}),l.each(function(t,i){var r=s(i);r.on("keyup",a(function(t){if(38!==t.keyCode&&40!==t.keyCode&&13!==t.keyCode&&27!==t.keyCode){var s,a,i=r.val(),l=e.ElasticPressAutoSuggest.postType;i.length>=2?(s=o(i,l),a=n(s),a.done(function(e){if(e._shards.successful>0){var t=e["post-suggest"][0].options;0===t.length?c():u(t,r)}else c()})):0===i.length&&c()}},100))})})})(this);